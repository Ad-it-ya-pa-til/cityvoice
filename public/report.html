<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Report Page - CityVoice</title>
  <link rel="stylesheet" href="/index.css">
  <link rel="stylesheet" href="/report.css">
  <script src="/darkmode.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <div class="report-container">
    <div class="report-header">
      <h1>Report Page</h1>
      <p>Submit a detailed report for review and action</p>
    </div>

    <div class="report-content">
      <form id="report-form">
        <!-- Report Details Section -->
        <div class="section">
          <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            Report Details
          </h2>

          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="report-id">
                Report ID
              </label>
              <input type="text" id="report-id" class="form-input" readonly value="RPT-2025-001">
            </div>

            <div class="form-group">
              <label class="form-label" for="report-date">
                Date of Creation <span class="required">*</span>
              </label>
              <input type="date" id="report-date" class="form-input" required>
            </div>

            <div class="form-group full-width">
              <label class="form-label" for="report-title">
                Report Title <span class="required">*</span>
              </label>
              <input type="text" id="report-title" class="form-input" placeholder="Enter report title" required>
            </div>

            <div class="form-group">
              <label class="form-label" for="author-name">
                Author Name <span class="required">*</span>
              </label>
              <input type="text" id="author-name" class="form-input" placeholder="Your full name" required>
            </div>

            <div class="form-group">
              <label class="form-label" for="author-email">
                Email <span class="required">*</span>
              </label>
              <input type="email" id="author-email" class="form-input" placeholder="your.email@example.com" required>
            </div>
          </div>
        </div>

        <!-- Report Content Section -->
        <div class="section">
          <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="17" y1="10" x2="3" y2="10"></line>
              <line x1="21" y1="6" x2="3" y2="6"></line>
              <line x1="21" y1="14" x2="3" y2="14"></line>
              <line x1="17" y1="18" x2="3" y2="18"></line>
            </svg>
            Report Description
          </h2>

          <div class="form-group full-width">
            <label class="form-label" for="report-description">
              Description / Content <span class="required">*</span>
            </label>
            <textarea 
              id="report-description" 
              class="form-textarea" 
              placeholder="Provide a detailed description of the issue or incident you want to report. Include relevant facts, observations, and any important context."
              required
            ></textarea>
          </div>
        </div>

        <!-- File Upload Section -->
        <div class="section">
          <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
            </svg>
            Attachments (Optional)
          </h2>

          <div class="file-upload-area" id="file-upload-area">
            <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <p class="upload-text">Click to upload or drag and drop</p>
            <p class="upload-hint">PDF, DOC, DOCX, Images (Max 10MB)</p>
            <input type="file" id="file-input" class="file-input" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
          </div>

          <div class="file-list" id="file-list"></div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button type="submit" class="btn btn-submit">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            Submit Report
          </button>
          <button type="button" class="btn btn-cancel" id="btn-cancel">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            Cancel
          </button>
        </div>
      </form>
    </div>

    <div class="back-link">
      <a href="/">‚Üê Back to Home</a>
    </div>
  </div>

  <script>
    const storage = {
      get token() { return localStorage.getItem('cv_token'); }
    };

    // Redirect to auth if not logged in
    if (!storage.token) {
      window.location.href = '/auth.html';
    }

    // Auto-generate Report ID
    function generateReportId() {
      const year = new Date().getFullYear();
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      return `RPT-${year}-${random}`;
    }

    // Set current date
    document.getElementById('report-date').valueAsDate = new Date();
    document.getElementById('report-id').value = generateReportId();

    // File upload handling
    const fileInput = document.getElementById('file-input');
    const fileUploadArea = document.getElementById('file-upload-area');
    const fileList = document.getElementById('file-list');
    let selectedFiles = [];

    fileUploadArea.addEventListener('click', () => fileInput.click());

    fileUploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileUploadArea.classList.add('dragover');
    });

    fileUploadArea.addEventListener('dragleave', () => {
      fileUploadArea.classList.remove('dragover');
    });

    fileUploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      fileUploadArea.classList.remove('dragover');
      const files = Array.from(e.dataTransfer.files);
      addFiles(files);
    });

    fileInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files);
      addFiles(files);
    });

    function addFiles(files) {
      files.forEach(file => {
        if (file.size > 10 * 1024 * 1024) {
          showToast('File size exceeds 10MB: ' + file.name, 'error');
          return;
        }
        selectedFiles.push(file);
      });
      renderFileList();
    }

    function removeFile(index) {
      selectedFiles.splice(index, 1);
      renderFileList();
    }

    function renderFileList() {
      if (selectedFiles.length === 0) {
        fileList.innerHTML = '';
        return;
      }

      fileList.innerHTML = selectedFiles.map((file, index) => `
        <div class="file-item">
          <div class="file-info">
            <svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
              <polyline points="13 2 13 9 20 9"></polyline>
            </svg>
            <span class="file-name">${file.name}</span>
          </div>
          <button type="button" class="file-remove" onclick="removeFile(${index})">Remove</button>
        </div>
      `).join('');
    }

    // Make removeFile global
    window.removeFile = removeFile;

    // Form submission
    document.getElementById('report-form').addEventListener('submit', (e) => {
      e.preventDefault();

      const reportData = {
        id: document.getElementById('report-id').value,
        date: document.getElementById('report-date').value,
        title: document.getElementById('report-title').value,
        authorName: document.getElementById('author-name').value,
        authorEmail: document.getElementById('author-email').value,
        description: document.getElementById('report-description').value,
        files: selectedFiles.map(f => f.name)
      };

      console.log('Report submitted:', reportData);
      showToast('Report submitted successfully!', 'success');

      // Reset form after 2 seconds
      setTimeout(() => {
        window.location.href = '/';
      }, 2000);
    });

    // Cancel button
    document.getElementById('btn-cancel').addEventListener('click', () => {
      if (confirm('Are you sure you want to cancel? All data will be lost.')) {
        window.location.href = '/';
      }
    });

    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 3000);
    }
  </script>
</body>
</html>
